---
slug: '2020-05-17-what-is-tree-shaking'
title: 'Vocabul√°rio do dev: O que √© tree shaking üå≤'
date: '2020-05-17'
author: 'Ra√≠ Siqueira'
published: true
description: 'O que √© tree shaking e porque √© t√£o importante saber o significado deste termo.'
categories:
  - 'javascript'
  - 'typescript'
  - 'webpack'
banner: './images/utsman-media-lWAzWOLod5g-unsplash.jpg'
bannerCredit: 'Utsman Media @ Unsplash'
---

Estamos acostumados a usar m√≥dulos no JavaScript (tamb√©m conhecidos como
[esm](https://nodejs.org/api/esm.html)) desde que o _ES6_ (ou _ES2015_) os m√≥dulos
_ECMAScript_ s√£o o formato padr√£o oficial para empacotar o c√≥digo JavaScript para
reutiliza√ß√£o. Em aplica√ß√µes com v√°rios m√≥dulos √© constante termos fun√ß√µes, m√©todos,
vari√°veis e tantos outros trechos de c√≥digo sem uso em nossas aplica√ß√µes.

O termo _tree shaking_ no mundo do JavaScript refere-se a remo√ß√£o de ‚Äúc√≥digo morto‚Äù
em nossa aplica√ß√£o, o nome se popularizou com o _Rollup_ ‚Äî um empacotador de m√≥dulos
_ES2015_. O tree shaking √© uma t√©cnica que analisa estaticamente o c√≥digo que √©
importado de algum m√≥dulo e durante o bundle remove trechos n√£o usados.
Esse passo √© bastante importante quando vamos preparar um build para produ√ß√£o,
gerando arquivos menores.

Ferramentas como **Webpack** ou o pr√≥prio **Rollup** citado acima detectam esses
c√≥digos que n√£o est√£o sendo usados na aplica√ß√£o e removem do pacote gerado no final.

## Bacana, mas o que √© considerado de fato um c√≥digo morto?

Essa resposta √© simples, vamos usar o **Webpack** como _module bundler_ em nosso exemplo,
√© o c√≥digo que o Webpack n√£o v√™ voc√™ usando, ele vai seguir a trilha de imports e
exports ao longo de nossa aplica√ß√£o, caso ele encontre algum m√≥dulo importado que
n√£o esteja sendo usado no m√≥dulo que o importou o Webpack vai considerar como ‚Äúc√≥digo morto‚Äù.

Vamos de exemplo:

```typescript
// module-01.ts
export function sum(a: number, b: number): number {
  return a + b
}

export function minus(a: number, b: number): number {
  return a - b
}

// main-module.ts
import { sum, minus } from './module-01'

const main = () => {
  console.log(sum(2 + 2))
}

main()
```

No Exemplo acima a fun√ß√£o _minus_ n√£o foi executada no c√≥digo, apenas importada,
isso quer dizer que, no nosso bundle final, o mesmo acontece com propriedades de
objetos que n√£o s√£o usadas, como no exemplo abaixo:

```typescript
// person.ts
export const person = {
  name: 'Rai Siqueira',
  birthday: '2 december',
}

// main.ts
import { person } from './person'

console.log(person.name)
```

No exemplo acima, a propriedade _birthday_ n√£o √© acessada, logo ser√° removida de
nosso _bunble_ final.

O tree shaking s√≥ funciona com as sintaxes _import_ e _export_, portanto n√£o
funciona com a sintaxe que usamos em m√≥dulos do tipo _commonJS_ (usando a sintaxe `require`).
Os exemplos acima tamb√©m se aplicam a depend√™ncias que baixamos do NPM, um exemplo
pr√°tico disso √© no uso do _Lodash_.

```typescript
import map from 'lodash/map'
```

O trecho de c√≥digo acima ir√° adicionar apenas o `map` do Lodash em nosso build,
e n√£o o Lodash por completo. Utilizar a t√©cnica de tree shaking e a elimina√ß√£o
do c√≥digo morto pode reduzir significativamente o tamanho do c√≥digo que temos em
nossa aplica√ß√£o. Quanto menos c√≥digo n√£o utilizado, maior ser√° o desempenho de nossa aplica√ß√£o.

Outra t√©cnica que podemos utilizar √© usando o site **BundlePhobia**, que tr√°s v√°rios
detalhes de um pacote publicado no NPM, como por exemplo o assunto deste artigo ‚Äî o
tree shaking.

Exemplo de pacote com suporte a tree shaking (note o √≠cone da √°rvore abaixo do nome do pacote):

![Bundlephobia with tree shaking](./images/bundlephobia01.png)

Exemplo de pacote sem suporte a tree shaking (sem o √≠cone da √°rvore abaixo do nome do pacote):

![Bundlephobia without tree shaking](./images/bundlephobia02.png)

Podemos melhorar a identifica√ß√£o de c√≥digo morto usando ferramentas de lint ,
por exemplo ESLint ou TSLint, vou indicar o plugin **ESLint Plugin unused imports**
[eslint-plugin-unused-imports - npm](https://www.npmjs.com/package/eslint-plugin-unused-imports)
que vai te ajudar a identificar os imports desnecess√°rios quando voc√™ estiver rodando.

Bom, espero ter ajudado voc√™ a desmistificar esse termo que ouvimos bastante quando estamos usando m√≥dulos no JavaScript.

_Refer√™ncias:_

- https://developer.mozilla.org/en-US/docs/Glossary/Tree_shaking
- https://webpack.js.org/guides/tree-shaking/
- https://nodejs.org/api/esm.html#esm_introduction
- https://rollupjs.org/guide/en/
- https://bundlephobia.com
